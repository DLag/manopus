sequencer:
  env:
    response: "Hello,"
  default_inputs:
    - slack
  default_outputs:
    - destination: slack
      type: callback
  sequences:
    - name: greating sequence
      steps:
        - name: ask for name
          match:
            - or:
              - field: req.direct
                value: true
              - field: req.mentioned
                value: true
            - field: req.message
              regexp: '(Hi|hi|Hello|hello)'
          processor:
            type: bash
            encoding: plain
            script:
              - 'echo "Hi <@$REQ_USER_ID>, what is your name?"'
          export:
            - current: req.user_id
              new: chat_user
        - name: greeting
          timeout: 60
          match:
            - or:
                - field: req.direct
                  value: true
                - field: req.mentioned
                  value: true
            - field: req.user_id
              compare: export.chat_user
            - field: req.message
              regexp: '(My|my) name is (?P<name>[A-Za-z]+)'
          processor:
            type: bash
            encoding: plain
            script:
              - echo $ENV_RESPONSE $MATCH_NAME
    - name: repeating sequence
      steps:
        - name: repeat
          match:
            - field: req.message
              regexp: '^Repeat: (?P<msg>.*)'
          processor:
            type: bash
            encoding: plain
            script:
              - echo $MATCH_MSG
    - name: request debug sequence
      steps:
        - name: debug
          match:
            - or:
                - field: req.direct
                  value: true
                - field: req.mentioned
                  value: true
            - field: req.message
              regexp: 'Debug$'
          processor:
            type: bash
            encoding: plain
            script: "( set -o posix ; set )"
    - name: simple processor sequence
      steps:
        - name: simple
          match:
            - or:
                - field: req.direct
                  value: true
                - field: req.mentioned
                  value: true
            - field: req.message
              regexp: 'Simple$'
          processor:
            type: simple
            encoding: none
            script:
              data: "Simple processor response"
          outputs:
            - destination: slack
              type: callback
    - steps:
      - inputs:
          - cli
        processor:
          type: bash
          encoding: plain
          script:
            - echo $ENV_RESPONSE $REQ_NAME